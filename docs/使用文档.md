# ResLibs 通用资源分享平台 - 使用文档

## 概述

ResLibs 是一个自动化多类型资源分享平台，支持 Unity Assets、软件工具、设计素材、视频课程、音频音乐、文档资料等多种资源类型的上传、管理和分发。

### 主要功能

- ✅ **多种资源类型支持**：6种主要资源类型，完整分类体系
- ✅ **管理员后台**：JWT认证的安全管理界面
- ✅ **前台展示**：响应式设计，支持搜索、筛选、分页
- ✅ **标签系统**：灵活的标签分类，支持颜色标识
- ✅ **下载管理**：多个下载源，价格和平台信息
- ✅ **完整测试**：E2E测试覆盖核心功能
- ✅ **种子数据**：丰富的测试数据，便于演示

## 快速开始

### 环境要求

- Node.js 18.0+
- npm 或 yarn
- SQLite（内置）

### 安装和启动

```bash
# 1. 安装依赖
npm install

# 2. 初始化数据库（包含种子数据）
npx prisma db push
npx tsx prisma/seed-full.ts

# 3. 启动开发服务器
npm run dev
```

访问地址：
- 前台：http://localhost:3000
- 管理后台：http://localhost:3000/admin/login

### 默认管理员账户

```
用户名: admin
邮箱: admin@reslibs.com
密码: admin123456
```

## 功能详解

### 1. 管理员后台

#### 登录认证
- JWT令牌认证
- 会话管理和自动过期
- 安全的密码哈希存储

#### 资源管理
- **查看资源列表**：支持分页、搜索、筛选
- **创建资源**：完整的资源信息录入
- **编辑资源**：修改资源状态和信息
- **删除资源**：安全的资源删除操作
- **状态管理**：草稿、已发布、已归档

#### 数据统计
- 资源总数统计
- 下载和浏览量统计
- 分类和类型分布

### 2. 前台展示

#### 资源浏览
- **资源网格**：响应式卡片布局
- **搜索功能**：支持标题和描述搜索
- **类型筛选**：按资源类型筛选
- **排序选项**：最新、最热、最多浏览等

#### 资源详情
- 完整的资源信息展示
- 标签显示和颜色标识
- 下载链接管理
- 统计信息展示

## API 接口文档

### 认证接口

#### POST /api/auth/login
管理员登录

**请求体：**
```json
{
  "username": "admin",
  "password": "admin123456"
}
```

**响应：**
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "user_id",
      "username": "admin",
      "email": "admin@reslibs.com",
      "name": "系统管理员",
      "role": "super_admin"
    },
    "token": "jwt_token"
  }
}
```

#### POST /api/auth/logout
管理员登出

**请求头：**
```
Authorization: Bearer <token>
```

### 资源接口

#### GET /api/resources
获取前台资源列表（公开访问）

**查询参数：**
- `page` (number): 页码，默认 1
- `limit` (number): 每页数量，默认 12
- `search` (string): 搜索关键词
- `type` (string): 资源类型筛选
- `sort` (string): 排序方式 (latest/popular/views/title)

**响应：**
```json
{
  "success": true,
  "data": {
    "resources": [
      {
        "id": "resource_id",
        "title": "资源标题",
        "description": "资源描述",
        "thumbnail": "缩略图URL",
        "downloadCount": 1000,
        "viewCount": 5000,
        "type": {
          "name": "unity-assets",
          "displayName": "Unity Assets",
          "icon": "🎮"
        },
        "category": {
          "name": "游戏开发",
          "icon": "🎮"
        },
        "tags": [
          {
            "tag": {
              "name": "免费",
              "color": "#10b981"
            }
          }
        ],
        "downloadLinks": [
          {
            "provider": "官方下载",
            "url": "下载链接",
            "price": "免费",
            "platform": "All"
          }
        ]
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 12,
      "total": 100,
      "totalPages": 9,
      "hasNext": true,
      "hasPrev": false
    }
  }
}
```

#### GET /api/admin/resources
获取管理员资源列表（需要认证）

**请求头：**
```
Authorization: Bearer <token>
```

**查询参数：**
- `page` (number): 页码
- `limit` (number): 每页数量
- `status` (string): 状态筛选 (draft/published/archived)
- `typeId` (string): 类型ID筛选
- `categoryId` (string): 分类ID筛选
- `search` (string): 搜索关键词

#### POST /api/admin/resources
创建新资源（需要认证）

**请求体：**
```json
{
  "title": "资源标题",
  "slug": "resource-slug",
  "description": "资源描述",
  "typeId": "type_id",
  "categoryId": "category_id",
  "status": "published",
  "tagIds": ["tag_id_1", "tag_id_2"],
  "downloadLinks": [
    {
      "provider": "下载提供商",
      "url": "下载链接",
      "price": "免费",
      "platform": "All",
      "quality": "Original"
    }
  ]
}
```

## 数据库结构

### 核心表结构

#### Resource (资源表)
- `id`: 唯一标识
- `title`: 资源标题
- `slug`: URL友好的标识符
- `description`: 资源描述
- `status`: 发布状态 (draft/published/archived)
- `downloadCount`: 下载次数
- `viewCount`: 浏览次数
- `typeId`: 资源类型ID（外键）
- `categoryId`: 分类ID（外键）

#### ResourceType (资源类型表)
- `id`: 唯一标识
- `name`: 类型名称（英文标识）
- `displayName`: 显示名称
- `icon`: 图标
- `fileExtensions`: 支持的文件扩展名

#### Category (分类表)
- `id`: 唯一标识
- `name`: 分类名称
- `slug`: URL标识符
- `icon`: 图标
- `supportedTypes`: 支持的资源类型

#### Tag (标签表)
- `id`: 唯一标识
- `name`: 标签名称
- `color`: 标签颜色
- `weight`: 权重（用于排序）

#### ResourceTag (资源标签关联表)
- `resourceId`: 资源ID
- `tagId`: 标签ID

#### DownloadLink (下载链接表)
- `id`: 唯一标识
- `resourceId`: 资源ID
- `provider`: 提供商
- `url`: 下载链接
- `price`: 价格
- `platform`: 支持平台
- `quality`: 质量

## 测试

### E2E测试

项目包含完整的端到端测试套件，使用 Playwright 框架。

#### 运行测试

```bash
# 安装 Playwright 浏览器
npx playwright install

# 运行所有测试
npm run test:e2e

# 运行特定测试
npx playwright test api-simple
```

#### 测试覆盖范围

- ✅ **认证功能测试**：登录、登出、权限验证
- ✅ **API接口测试**：资源CRUD、数据验证
- ✅ **前台页面测试**：资源浏览、搜索、筛选
- ✅ **数据完整性测试**：种子数据验证

#### 测试结果

```
API 基础功能测试
✓ 登录 API 应该工作
✓ 管理员资源 API 应该受保护
✓ 管理员资源 API 应该在认证后工作
✓ 前台资源 API 应该公开访问
✓ 前台资源 API 应该返回正确的数据结构
✓ 应该支持分页
✓ 所有种子数据应该完整存在
✓ 资源应该有正确的元数据
```

## 种子数据

系统预置了丰富的测试数据，包含：

### 资源类型（6种）
- 🎮 Unity Assets：Unity 游戏引擎资源和工具
- ⚙️ 软件工具：各种实用软件和开发工具
- 🎨 设计素材：UI 设计素材、图标、图片等
- 📹 视频课程：教学视频和在线课程
- 🎵 音频音乐：背景音乐、音效、音频素材等
- 📚 文档资料：技术文档、教程、手册等

### 分类体系（7个）
- 🎮 游戏开发：游戏开发相关资源
- 🎨 设计创意：UI设计、平面设计、3D设计等
- 📚 教育学习：编程教学、视频课程等
- ⚙️ 开发工具：编程工具、开发环境等
- 🌐 Web开发：前端框架、后端框架等
- 📱 移动开发：iOS、Android开发等
- 🎬 多媒体制作：视频编辑、音频处理等

### 示例资源（6个）
1. **Low Poly Shooter Pack** - Unity 游戏资源包
2. **Blender 3D 建模软件** - 开源3D建模工具
3. **Modern UI Design System** - UI设计组件库
4. **Unity游戏开发完整教程** - 视频课程
5. **RPG游戏背景音乐集** - 音频素材
6. **React 开发完整指南** - 技术文档

### 标签系统（10个）
- 免费、优质、热门、新手友好、开源、专业版、教程、素材包、完整项目、模板

## 部署指南

### 生产环境部署

1. **环境变量配置**
```bash
DATABASE_URL="file:./dev.db"
NEXTAUTH_SECRET="your-secret-key"
NODE_ENV="production"
```

2. **数据库初始化**
```bash
npx prisma db push
npx tsx prisma/seed-full.ts
```

3. **构建应用**
```bash
npm run build
```

4. **启动应用**
```bash
npm start
```

### Docker部署（可选）

```dockerfile
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npx prisma generate
RUN npx prisma db push

EXPOSE 3000
CMD ["npm", "start"]
```

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查 `DATABASE_URL` 环境变量
   - 确保数据库文件权限正确

2. **认证失败**
   - 检查 `NEXTAUTH_SECRET` 环境变量
   - 清除浏览器localStorage中的token

3. **种子数据缺失**
   - 重新运行 `npx tsx prisma/seed-full.ts`
   - 检查数据库表结构

4. **测试失败**
   - 安装 Playwright 浏览器：`npx playwright install`
   - 确保开发服务器正在运行

### 日志和调试

- 开发环境日志：控制台输出
- 数据库查询：Prisma Query日志
- API错误：HTTP响应中的错误信息

## 贡献指南

### 开发流程

1. Fork 项目
2. 创建功能分支
3. 提交代码变更
4. 运行测试确保通过
5. 提交 Pull Request

### 代码规范

- 使用 TypeScript
- 遵循 ESLint 规则
- 编写测试用例
- 添加适当的注释

## 版本历史

- **v1.0.0** - 初始版本
  - 完整的资源管理功能
  - 管理员后台系统
  - 前台展示界面
  - E2E测试覆盖

## 联系方式

如有问题或建议，请通过以下方式联系：

- 项目Issues：GitHub Issues
- 邮箱：admin@reslibs.com

---

*最后更新：2025年11月*